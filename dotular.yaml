age:
  identity: ~/.config/dotular/identity.txt

modules:
  # --- local module -----------------------------------------------------------
  - name: homebrew
    hooks:
      before_apply: echo "==> setting up Homebrew"
    items:
      - script: https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh
        via: remote
        skip_if: command -v brew
        verify: brew --version

  # --- registry module --------------------------------------------------------
  # - from: dotular.dev/modules/neovim@1.0.0
  #   with:
  #     neovim_version: "0.10.2"
  #   override:
  #     - directory: nvim
  #       direction: push
  #       destination: ~/.config/nvim

  # --- local module with new item types ---------------------------------------
  - name: Visual Studio Code
    only_tags: [darwin, linux]
    hooks:
      before_apply: echo "==> installing VS Code"
      after_apply: echo "==> VS Code ready"
    items:
      - package: visual-studio-code
        via: brew-cask
        verify: code --version

      - package: Microsoft.VisualStudioCode
        via: winget

      - file: settings.json
        direction: sync
        permissions: "0600"
        destination:
          macos: ~/Library/Application Support/Code/User
          windows: '%APPDATA%\\Code\\User'
        hooks:
          before_sync: echo "syncing VS Code settings"

      - file: keybindings.json
        direction: push
        destination:
          macos: ~/Library/Application Support/Code/User
          windows: '%APPDATA%\\Code\\User'

  - name: Neovim (manual)
    items:
      - binary: nvim
        version: "0.10.2"
        source:
          macos: https://github.com/neovim/neovim/releases/download/v0.10.2/nvim-macos-arm64.tar.gz
          linux: https://github.com/neovim/neovim/releases/download/v0.10.2/nvim-linux-x86_64.tar.gz
        install_to: ~/.local/bin
        skip_if: test -f ~/.local/bin/nvim
        verify: nvim --version

      - directory: nvim
        direction: push
        destination: ~/.config

      - run: nvim --headless "+Lazy sync" +qa
        after: directory

  - name: WezTerm
    items:
      - package: wezterm
        via: brew-cask
        verify: wezterm --version

      - file: .wezterm.lua
        direction: push
        destination:
          macos: ~
          linux: ~
